<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jovan's Idiom Rescue: RPG Edition</title>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-8Z53DTDB23"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-8Z53DTDB23');
    </script>

    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'VT323', "Kaiti TC", "Ê•∑È´î", sans-serif; 
            background-color: #4aa02c; 
            background-image: repeating-conic-gradient(#4aa02c 0% 25%, #449028 0% 50%);
            background-size: 60px 60px; color: #fff; text-align: center; margin: 0; padding: 10px; overflow-x: hidden;
        }

        #hero-status {
            background: #3d2b1f; border: 4px solid #1a120c; border-radius: 15px;
            max-width: 600px; margin: 0 auto 15px; padding: 12px; text-align: center;
            color: #fff; box-shadow: 0 6px 0 #000;
        }
        #hero-name { color: #FFFF55; font-size: 1.8em; text-shadow: 2px 2px #000; margin-bottom: 5px; }
        .global-xp-display { color: #55FF55; font-size: 1.4em; }

        #rescue-scene { position: relative; width: 220px; height: 220px; margin: 15px auto; background: #999; border: 8px solid #3d2b1f; border-radius: 10px; box-shadow: 0 10px 0 rgba(0,0,0,0.5); }
        #animal { font-size: 110px; line-height: 200px; transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        
        .bars-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; justify-content: space-around; padding: 0 10px; box-sizing: border-box; z-index: 10; }
        .bar { width: 12px; height: 100%; background: #555; border-left: 4px solid #777; border-right: 4px solid #333; transition: transform 0.8s, opacity 0.5s; }
        .bar.removed { transform: translateY(-110%); opacity: 0; }

        .unlocked #animal { transform: scale(1.3) rotate(10deg); text-shadow: 0 0 20px #fff; }

        .slot-container { display: flex; justify-content: center; gap: 8px; margin: 15px 0; }
        .slot { width: 65px; height: 65px; background: rgba(0,0,0,0.6); border: 4px solid #fff; border-radius: 10px; font-size: 40px; line-height: 65px; color: #FFFF55; transition: 0.3s; }
        .slot.correct-slot { border-color: #55FF55; background: rgba(85, 255, 85, 0.2); }

        .card-container { display: flex; justify-content: center; gap: 12px; margin-top: 20px; flex-wrap: wrap; }
        .word-card { 
            width: 75px; height: 75px; background: #8b5e3c; border: 4px solid #3d2b1f; 
            border-bottom-width: 8px; border-radius: 10px; font-size: 40px; line-height: 75px; 
            cursor: pointer; transition: 0.1s; color: #fff; box-shadow: 0 4px 0 #000;
        }
        .word-card:active { transform: translateY(4px); border-bottom-width: 4px; }
        .word-card.used { opacity: 0; pointer-events: none; }

        #message { font-size: 1.6em; color: #FFFF55; text-shadow: 2px 2px #000; min-height: 1.2em; margin: 10px 0; }
        .btn { padding: 10px 25px; font-family: 'VT323'; font-size: 1.4em; cursor: pointer; border: 4px solid #333; color: #fff; background: #3498db; margin: 5px; border-bottom-width: 6px; }
        .btn:active { transform: translateY(4px); border-bottom-width: 2px; }
        .btn-speak { background: #f1c40f; color: #000; }

        #collection-shelf { background: rgba(0,0,0,0.4); border: 4px solid #3d2b1f; border-radius: 15px; margin: 20px auto; max-width: 900px; padding: 15px; min-height: 60px; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
        .collected-animal { font-size: 35px; background: rgba(255,255,255,0.1); border-radius: 8px; padding: 5px; animation: popIn 0.5s forwards; }
        @keyframes popIn { 0% { transform: scale(0); } 100% { transform: scale(1); } }

        #xp-container { position: fixed; bottom: 0; left: 0; width: 100%; height: 15px; background: #222; z-index: 100; }
        #xp-bar { height: 100%; width: 0%; background: #55FF55; transition: width 0.5s; }

        @keyframes fadeUp {
            0% { transform: translate(-50%, 0); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translate(-50%, -100px); opacity: 0; }
        }
    </style>
</head>
<body>

    <h1 style="text-shadow: 3px 3px #000; color: #55FF55; margin: 10px 0;">üêæ IDIOM RESCUE RPG üêæ</h1>

    <div id="hero-status">
        <div id="hero-name">Loading Identity...</div>
        <div class="global-xp-display">TOTAL XP: <span id="global-total-xp">0</span></div>
    </div>

    <div id="rescue-scene">
        <div class="bars-container" id="bars">
            <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
        </div>
        <div id="animal">üê∑</div>
    </div>

    <div id="message">Á≠îÂï± 4 ÂÄãÊàêË™ûÂ∞±ÊïëÂà∞ÂãïÁâ©ÔºÅ</div>

    <div style="margin-bottom: 10px;">
        <button class="btn btn-speak" onclick="speakIdiom()">üîä ËÅΩËÆÄÈü≥ (Listen)</button>
    </div>

    <div class="slot-container" id="slot-actual">
        <div class="slot" id="slot-0"></div><div class="slot" id="slot-1"></div>
        <div class="slot" id="slot-2"></div><div class="slot" id="slot-3"></div>
    </div>

    <div class="card-container" id="cards"></div>

    <div style="margin-top: 15px;">
        <button class="btn" style="background:#e74c3c" onclick="resetSlots()">üóëÔ∏è ÈáçË©¶È°å (Reset)</button>
        <button class="btn" id="nextQuestBtn" style="display:none; background:#f1c40f; color:#000;" onclick="startNewIdiomInRescue()">‚è≠Ô∏è ‰∏ã‰∏ÄÈóú (Next Quest)</button>
        <button class="btn" id="finishRescueBtn" style="display:none; background:#55FF55; color:#000;" onclick="initRescueSession()">üéÅ Êïë‰∏ã‰∏ÄÈöª (New Animal)</button>
    </div>

    <h3 style="margin-bottom: 5px; text-shadow: 2px 2px #000;">My Collection (Â∑≤ÊïëÂãïÁâ©: <span id="saveCount">0</span>)</h3>
    <div id="collection-shelf"></div>

    <div id="xp-container"><div id="xp-bar"></div></div>

    <script type="module">
        import { db, doc, setDoc } from './firebase-config.js';

        const idiomDB = [
            { word: "‰∏Ä‰∫î‰∏ÄÂçÅ", hint: "Ë±¨‰ªîÊÉ≥ËÅΩ‰Ω†Ë¨õÂæóÊ∏ÖÊ∏ÖÊ•öÊ•öÔºÅ" }, { word: "‰∏ÄÂøÉ‰∏ÄÊÑè", hint: "Áæä‰ªîÊÉ≥‰Ω†Â∞àÂøÉÊïë‰Ω¢ÔºÅ" },
            { word: "‰∏âÂøÉ‰∫åÊÑè", hint: "ÂîîÂ•ΩË´ó‰ΩèÁé© Minecraft ÂëÄÔºåÂ∞àÂøÉÂï≤ÔºÅ" }, { word: "ÂõõÈÄöÂÖ´ÈÅî", hint: "Âë¢Ê¢ùË∑ØÂ•Ω‰ººÁ§¶ÂùëÂíÅÂë®ÂúçÈÉΩÂéªÂà∞„ÄÇ" },
            { word: "‰∫îÂÖâÂçÅËâ≤", hint: "ÁâõÁâõÈçæÊÑèÂΩ©Ëâ≤ÂòÖ‰∏ñÁïåÔºÅ" }, { word: "ÂÖ≠Á•ûÁÑ°‰∏ª", hint: "Â∞èÈõûÂöáÂà∞ÂîîÁü•ÂéªÂíóÈÇäÔºÅ" },
            { word: "‰∏É‰∏äÂÖ´‰∏ã", hint: "ÊïëÂîîÂà∞ÁãêÁã∏‰ªîÔºåÂøÉË∑≥ÂæóÂ•ΩÂø´ÔºÅ" }, { word: "ÂÖ´‰ªôÈÅéÊµ∑", hint: "Â§ßÂÆ∂‰∏ÄÈΩäÁî®Ë∂ÖËÉΩÂäõÊïëÂãïÁâ©ÔºÅ" },
            { word: "‰πùÁâõ‰∏ÄÊØõ", hint: "Êïë‰∏ÄÈöªÁâõÁâõÂè™‰øÇÂ•ΩÂ∞è‰∫ãÔºÅ" }, { word: "ÂçÅÂÖ®ÂçÅÁæé", hint: "ÊïëÊôíÊâÄÊúâÂãïÁâ©Â∞±ÊúÄÂÆåÁæéÂñáÔºÅ" },
            { word: "ÁôæÁôºÁôæ‰∏≠", hint: "Â•Ω‰ººÁî®ÂºìÁÆ≠Â∞Ñ‰∏≠Èù∂ÂøÉÂíÅÊ∫ñÔºÅ" }, { word: "ÂçÉËÆäËê¨Âåñ", hint: "Âë¢ÂÄãÂú∞ÂúñÂ•ΩÁ•ûÁ•ïÔºåÊàêÊó•ËÆäÔºÅ" },
            { word: "È¶¨Âà∞ÂäüÊàê", hint: "È¶¨‰ªîÁ•ù‰Ω†‰∏ÄË©¶Â∞±ÊàêÂäüÔºÅ" }, { word: "‰∫°ÁæäË£úÁâ¢", hint: "Áæä‰ªîËµ∞ÂíóÔºüÂø´Âï≤Êï¥ËøîÂ•ΩÂÄãÊ¨ÑÂï¶ÔºÅ" },
            { word: "ÈæçÈ£õÈ≥≥Ëàû", hint: "Âï≤Â≠óÂØ´ÂæóÂ•ΩÈùöÔºåÂ•Ω‰ººÈæçÂñ∫Â∫¶È£õÔºÅ" }, { word: "ËôéÈ†≠ËõáÂ∞æ", hint: "ÊïëÂãïÁâ©Ë¶ÅÊïëÂà∞Â∫ïÔºåÂîîÂ•ΩÂçäÈÄîËÄåÂª¢ÔºÅ" },
            { word: "ÁãêÂÅáËôéÂ®Å", hint: "Â∞èÁãêÁã∏ÊÉ≥ÊâÆËÄÅËôéÂéªÂöá‰∫∫ÔºÅ" }, { word: "ÁãºÂêûËôéÂö•", hint: "È§ìÂíóÂ•ΩËÄêÂòÖÁãº‰ªîÂñ∫Â∫¶Â§ßÂè£È£üÂò¢ÔºÅ" },
            { word: "ÈõûÈ£õÁãóË∑≥", hint: "Ëæ≤Â†¥ÁôºÁîüÂíóÂí©‰∫ãÔºüÂíÅÂòàÂòÖÔºÅ" }, { word: "‰∫ïÂ∫ï‰πãËõô", hint: "ÈùíËõô‰ªîÊÉ≥Ë∑≥Âá∫ÂÄã‰∫ïÁùá‰∏ñÁïåÔºÅ" },
            { word: "ÂÆàÊ†™ÂæÖÂÖî", hint: "ÂÖî‰ªîÂîîÊúÉËá™Â∑±ÊíûÂüãÂöü„óéÔºåÂø´Âï≤Êïë‰Ω¢ÔºÅ" }, { word: "Áï´ÈæçÈªûÁùõ", hint: "ÊúÄÂæå‰∏ÄÁ≠ÜÂØ´Âï±ÔºåÈæçÂ∞±È£õÂá∫ÂöüÔºÅ" },
            { word: "È¢®ÂíåÊó•È∫ó", hint: "‰ªäÊó•Â§©Ê∞£Â•ΩÂ•ΩÔºåÊúÄÂï±ÂéªÊé¢Èö™ÔºÅ" }, { word: "ÈôΩÂÖâÁá¶Áàõ", hint: "Â§™ÈôΩ‰ºØ‰ºØÂá∫ÂíóÂöüÔºåÂîîÈ©ö Creeper ÂñáÔºÅ" },
            { word: "Êò•ÊöñËä±Èñã", hint: "Êò•Â§©Âà∞ÂíóÔºåËä±ÂúíÂï≤Ëä±ÈñãÊôíÂñáÔºÅ" }, { word: "ÁÉàÊó•Áï∂Á©∫", hint: "Â•ΩÁÜ±ÂëÄÔºåÂø´Âï≤ÊïëÁâõÁâõÂéªÈô∞Ê∂ºËôïÔºÅ" },
            { word: "ÁßãÈ´òÊ∞£ÁàΩ", hint: "ÁßãÂ§©ÂòÖÈ¢®ÂêπÂæóÂ•ΩËàíÊúç„ÄÇ" }, { word: "ÂÜ∞Â§©Èõ™Âú∞", hint: "Èõ™Âú∞Â•ΩÂáçÔºåÂø´Âï≤Âπ´Áãº‰ªî‰øùÊöñÔºÅ" },
            { word: "Â±±ÈùíÊ∞¥ÁßÄ", hint: "Âë¢ÂÄã‰∏ñÁïåÂòÖÂ±±Ê∞¥Áúü‰øÇÈùöÔºÅ" }, { word: "È¢®Âπ≥Êµ™Èùú", hint: "Â§ßÊµ∑Â•ΩÂπ≥ÈùúÔºåÂùêËàπÂéªÊïë‰∫∫Âï¶ÔºÅ" },
            { word: "ÁúâÊ∏ÖÁõÆÁßÄ", hint: "Âë¢ÂÄã‰∫∫ÊúõËêΩÂ•ΩÁ≤æÁ•ûÂñéÔºÅ" }, { word: "Ë°£ÂÜ†Ê•öÊ•ö", hint: "ËëóÂæóÂ•ΩÊï¥ÈΩäÔºåÂ•Ω‰ººË¶ÅÂéªÂèÉÂä†ËÅöÊúÉ„ÄÇ" },
            { word: "ÂûÇÈ†≠Âñ™Ê∞£", hint: "ÂîîÂ•ΩÂîîÈñãÂøÉÔºåÂÜçË©¶‰∏ÄÊ¨°Â∞±ÊïëÂà∞ÔºÅ" }, { word: "ÁõÆÁû™Âè£ÂëÜ", hint: "Ë¶ãÂà∞ Enderman ÂöáÂà∞ÂëÜÂíóÔºÅ" },
            { word: "ÊçßËÖπÂ§ßÁ¨ë", hint: "Ë±¨‰ªîË∑≥Ëàû‰ª§Âà∞Â§ßÂÆ∂Â•ΩÈñãÂøÉÔºÅ" }, { word: "Âè£Ëã•Êá∏Ê≤≥", hint: "Ë¨õÂò¢Â•ΩÊµÅÂà©ÔºåÂÅúÂîîÂà∞Âè£ÔºÅ" },
            { word: "Âª¢ÂØ¢ÂøòÈ£ü", hint: "Â∞àÂøÉÂà∞ÂîîË®òÂæóÈ£üÈ£ØÂêåÁûìË¶∫ÔºÅ" }, { word: "ËÅöÁ≤æÊúÉÁ•û", hint: "Â∞çÁúºÊúõÂØ¶ÂÄãËû¢ÂπïÔºåÂ∞àÂøÉÊïëÂãïÁâ©ÔºÅ" },
            { word: "Ëá™Ë®ÄËá™Ë™û", hint: "ÁãóÁãóÂñ∫Â∫¶Á¥∞ËÅ≤ÂêåËá™Â∑±Ë¨õÂò¢„ÄÇ" }, { word: "Â§ßÂÖ¨ÁÑ°ÁßÅ", hint: "Ë≤ìË≤ìÊÉ≥Â§ßÂÆ∂ÂÖ¨Âπ≥ÂàÜÈÖçÈ≠öÈ≠öÔºÅ" },
            { word: "Êç®Â∑±ÁÇ∫‰∫∫", hint: "ÂãáÊï¢ÂòÖ Steve Ëµ∞ÂéªÊïëÂ§ßÂÆ∂ÔºÅ" }, { word: "Áü•ÈåØËÉΩÊîπ", hint: "ÂØ´ÈåØÂíóÂîîÁ∑äË¶ÅÔºåÊîπËøîÂ∞±‰øÇÂ•ΩÁ¥∞Ë∑ØÔºÅ" },
            { word: "ÂçäÈÄîËÄåÂª¢", hint: "ÂîîÂ•ΩÁé©Âà∞‰∏ÄÂçäÂ∞±Ëµ∞ÂíóÂéªÂëÄÔºÅ" }, { word: "ÂÖ®Âäõ‰ª•Ëµ¥", hint: "Áî®ÊôíÊâÄÊúâÂäõÊ∞£ÂéªÂÆåÊàêÊØèÊó•‰ªªÂãôÔºÅ" },
            { word: "ÂêçÂàóÂâçËåÖ", hint: "ËÄÉË©¶ËÄÉÂæóÂ•ΩÔºåÊéíÂñ∫Â•ΩÂâçÈù¢ÔºÅ" }, { word: "ÂêçÂâØÂÖ∂ÂØ¶", hint: "Áúü‰øÇÂ•Ω‰ººÂÇ≥ËÅû‰∏≠ÂíÅÂãÅÔºÅ" },
            { word: "ÊãîËãóÂä©Èï∑", hint: "ÂîîÂ•ΩÊÄ•ÔºåÁ¶æËãóË¶ÅÊÖ¢ÊÖ¢Â§ß„óé„ÄÇ" }, { word: "Ê∞¥ËêΩÁü≥Âá∫", hint: "ÁúüÁõ∏ÁµÇÊñºÂá∫ÁèæÂñáÔºÅ" },
            { word: "Âá∫Âè£ÊàêÁ´†", hint: "‰∏ÄÈñãÂè£Â∞±Ë¨õÂà∞Â•ΩÈùöÂòÖÂè•Â≠ê„ÄÇ" }, { word: "Âä©‰∫∫ÁÇ∫Ê®Ç", hint: "Âπ´Âà∞‰∫∫ÔºåËá™Â∑±ÈÉΩÈñãÂøÉÂï≤ÔºÅ" },
            { word: "ËÄ≥ÁõÆ‰∏ÄÊñ∞", hint: "ÊèõÂíóÊñ∞ SkinÔºåÊàêÂÄã‰∫∫ÂîîÂêåÊôíÔºÅ" }, { word: "Ë¶ãÁæ©ÂãáÁÇ∫", hint: "Ë¶ãÂà∞ÊúâÂãïÁâ©Ë¢´Âõ∞ÔºåÂç≥ÂàªË°ùÂéªÊïëÔºÅ" },
            { word: "ÂÖâÈô∞‰ººÁÆ≠", hint: "ÊôÇÈñìÈÅéÂæóÂ•ΩÂø´ÔºåË¶ÅÁèçÊÉúÂëÄÔºÅ" }, { word: "ÂêçÂ±±Â§ßÂ∑ù", hint: "ÂéªÊóÖË°åÁùá‰∏ã‰∏ñÁïåÂêÑÂú∞ÂòÖÂêçÂ±±„ÄÇ" },
            { word: "Âõ†ÊùêÊñΩÊïô", hint: "ÊØèÂÄã‰∫∫Â≠∏Âò¢ÂòÖÊñπÊ≥ïÈÉΩÂîîÂêå„ÄÇ" }, { word: "Â§öÊâçÂ§öËóù", hint: "Jovan ÂèàË≠òÂΩàÁê¥ÂèàË≠òÂØ´ CodeÔºÅ" },
            { word: "Â¶ÇÈ≠öÂæóÊ∞¥", hint: "ÂéªÂà∞ÈçæÊÑèÂòÖÁí∞Â¢ÉÔºåÂ•ΩËá™Âú®ÔºÅ" }, { word: "ÂÆâÂàÜÂÆàÂ∑±", hint: "‰πñ‰πñÂú∞ÂÆàË¶èÁü©„ÄÇ" },
            { word: "Ëá™Âº∑‰∏çÊÅØ", hint: "ÊØèÊó•ÈÉΩË¶ÅÂä™ÂäõÈÄ≤Ê≠•ÔºÅ" }, { word: "Ê±óÊµÅÊµπËÉå", hint: "ÂÅöÂÆåÈÅãÂãïÔºåÊàêË∫´ÈÉΩ‰øÇÊ±ó„ÄÇ" },
            { word: "Â¶ôÊâãÂõûÊò•", hint: "Â•Ω‰ººÈÜ´ÁîüÂíÅÈÜ´ËøîÂ•ΩÂèóÂÇ∑ÂòÖË±¨‰ªî„ÄÇ" }, { word: "ÂøóÂêåÈÅìÂêà", hint: "ÊêµÂà∞‰∏ÄÁè≠Â•ΩÊúãÂèã‰∏ÄÈΩäÁé© MinecraftÔºÅ" },
            { word: "ÊîπÈÇ™Ê≠∏Ê≠£", hint: "ÊÄ™Áç∏ÈÉΩÊÉ≥ËÆäËøîÂ•Ω‰∫∫„ÄÇ" }, { word: "ÂèñÈï∑Ë£úÁü≠", hint: "Â≠∏‰∏ã‰∫∫ÂìãÂòÖÂÑ™Èªû„ÄÇ" },
            { word: "‰æù‰æù‰∏çÊç®", hint: "Ë¶ÅÊî∂Ê©üÂñáÔºåÁúü‰øÇÂîîÊç®Âæó„ÄÇ" }, { word: "Áâ©ÁæéÂÉπÂªâ", hint: "Âñ∫Ëã±ÂúãË∂ÖÂ∏ÇË≤∑Âà∞ÂèàÂπ≥ÂèàÂ•ΩÂòÖÂò¢„ÄÇ" },
            { word: "Ëã¶Áõ°Áîò‰æÜ", hint: "ËæõËã¶ÂÆåÔºåÁµÇÊñºÊúâÊî∂Á©´ÔºÅ" }, { word: "Áæé‰∏çÂãùÊî∂", hint: "È¢®ÊôØÈùöÂà∞ÁùáÂîîÊôí„ÄÇ" },
            { word: "Èù¢Á¥ÖËÄ≥Ëµ§", hint: "ÂîîÂ•ΩÁà≠ÂêµÔºåË¨õÂà∞Èù¢ÈÉΩÁ¥ÖÊôí„ÄÇ" }, { word: "Ê¥óÂøÉÈù©Èù¢", hint: "Ê±∫ÂÆöÈáçÊñ∞ÂÅö‰∏ÄÂÄãÂ•Ω‰∫∫„ÄÇ" },
            { word: "Ê¥•Ê¥•ÊúâÂë≥", hint: "È£üÂæóÂ•ΩÈñãÂøÉÔºåÂ•ΩÂ•ΩÂë≥ÔºÅ" }, { word: "ÊµÅÈÄ£ÂøòËøî", hint: "Âë¢ÂÄãÂÖ¨ÂúíÂ§™Â•ΩÁé©ÔºåÂîîÊÉ≥ËøîÂ±ã‰ºÅ„ÄÇ" },
            { word: "ËÉ∏ÊúâÊàêÁ´π", hint: "Â•ΩÊúâ‰ø°ÂøÉÂèØ‰ª•ÊïëÂà∞ÂãïÁâ©ÔºÅ" }, { word: "Ë≤°Ê∫êÂª£ÈÄ≤", hint: "Á•ùÂ§ßÂÆ∂Ë≥∫Â§öÂï≤Èå¢Ë≤∑ÈëΩÁü≥ÔºÅ" },
            { word: "ÊÉÖÊ∑±Áæ©Èáç", hint: "Â§ßÂÆ∂ÂòÖÂèãË™ºÂ•ΩÊ∑±Âéö„ÄÇ" }, { word: "ÂæóÊÑèÂøòÂΩ¢", hint: "ÂîîÂ•ΩÈñãÂøÉÈÅéÈ†≠ÔºåÂ∞èÂøÉË∑åË¶™ÔºÅ" },
            { word: "Ê∑±ÊÄùÁÜüÊÖÆ", hint: "Ë´óÊ∏ÖÊ•öÂÖàËá≥Ë°åÂãï„ÄÇ" }, { word: "Ë≤™Â∞è‰æøÂÆú", hint: "ÂîîÂ•ΩÂõ†ÁÇ∫Â∞ëÂ∞ëÂò¢ËÄåË≤™ÂøÉ„ÄÇ" },
            { word: "ÊÇ∂ÊÇ∂‰∏çÊ®Ç", hint: "‰ªäÊó•ÈªûËß£ÂîîÈñãÂøÉÂëÄÔºüË¨õÁïÄÊàëËÅΩ„ÄÇ" }, { word: "ÊèöÁúâÂêêÊ∞£", hint: "ÁµÇÊñºË¥èÂíóÔºåÁúü‰øÇÂ•ΩÈñãÂøÉÔºÅ" },
            { word: "ÊúùÊ∞£Ëì¨ÂãÉ", hint: "ÊØèÊó•Ëµ∑Ë∫´ÈÉΩÂÖÖÊªøÊ¥ªÂäõÔºÅ" }, { word: "Âæ™Â∫èÊº∏ÈÄ≤", hint: "‰∏ÄÊ≠•‰∏ÄÊ≠•ÊÖ¢ÊÖ¢Â≠∏ÔºåÂîî‰ΩøÊÄ•„ÄÇ" },
            { word: "ÂæÆ‰∏çË∂≥ÈÅì", hint: "Âë¢Âï≤Âè™‰øÇÂ•ΩÂ∞èÂòÖ‰∫ã„ÄÇ" }, { word: "ÊÑèÊ∞£È¢®Áôº", hint: "Ë¥èÂíóÊØîË≥ΩÔºåÂ•ΩÂ®ÅÈ¢®ÔºÅ" },
            { word: "ÊÑõ‰∏çÈáãÊâã", hint: "Âë¢ÂÄã Minecraft Áé©ÂÖ∑Áúü‰øÇÂ•ΩÈçæÊÑè„ÄÇ" }, { word: "ËêΩËçíËÄåÈÄÉ", hint: "Ë¶ãÂà∞ Creeper Â∞±Ë¶ÅÂø´Âï≤Ëµ∞ÔºÅ" },
            { word: "Â∞çÁâõÂΩàÁê¥", hint: "ÂêåÂîîÊòéÂòÖ‰∫∫Ë¨õÈÅìÁêÜÔºåÂÜáÁî®„óé„ÄÇ" }, { word: "ÂØ¶‰∫ãÊ±ÇÊòØ", hint: "Ë¶ÅÂÅöËøîÂï≤ÁúüÊ≠£ÊúâÊÑèÁæ©ÂòÖ‰∫ã„ÄÇ" },
            { word: "Á≤æÁõäÊ±ÇÁ≤æ", hint: "Â∑≤Á∂ìÂÅöÂæóÂ•ΩÂ•ΩÔºåÊÉ≥ÂÜçÂÅöÂ•ΩÂï≤ÔºÅ" }, { word: "ËÅöÊ≤ôÊàêÂ°î", hint: "ÊÖ¢ÊÖ¢ÂÑ≤ÔºåÂ∞±ÂèØ‰ª•ËÆäÂá∫Â§ßÂüéÂ†°„ÄÇ" },
            { word: "Â≠∏ÁÑ°Ê≠¢Â¢É", hint: "Â≠∏Âò¢‰øÇ‰∏Ä‰∏ñÂòÖ‰∫ã„ÄÇ" }, { word: "Ê©üÊô∫ÂãáÊï¢", hint: "ÂèàËÅ∞ÊòéÂèàÂãáÊï¢ÂéªÊåëÊà∞Èõ£Èóú„ÄÇ" },
            { word: "Ëàâ‰∏ÄÂèç‰∏â", hint: "Â≠∏‰∏Ä‰ª∂‰∫ãÔºåÂ∞±ÂèØ‰ª•Ë´óÂà∞‰∏â‰ª∂‰∫ãÔºÅ" }, { word: "Ë¨ôËôõÂ•ΩÂ≠∏", hint: "ÂîîËá™Â§ßÔºåÂèàÈçæÊÑèÂ≠∏Êñ∞Âò¢„ÄÇ" },
            { word: "Ë±ÅÁÑ∂ÈñãÊúó", hint: "Á™ÅÁÑ∂‰πãÈñìÊòéÁôΩÊôíÊâÄÊúâÂò¢ÔºÅ" }, { word: "ËÆÄËê¨Âç∑Êõ∏", hint: "Ë¶ÅËÆÄÂ§öÂï≤Êõ∏ÔºåÂ•Ω‰ººË°åÂíóËê¨ÈáåË∑Ø„ÄÇ" },
            { word: "ÈêµÁü≥ÂøÉËÖ∏", hint: "ÂîîÂ•ΩÂíÅÁ°¨ÂøÉËÖ∏ÔºåÂø´Âï≤ÊïëÂãïÁâ©ÔºÅ" }, { word: "Ê≠°Â§©ÂñúÂú∞", hint: "Â§ßÂÆ∂‰∏ÄÈΩäÂéªÊÖ∂Á•ùÂõâÔºÅ" },
            { word: "È©öÂ§©ÂãïÂú∞", hint: "ÁôºÁîüÂíó‰∏Ä‰ª∂Â•ΩÈúáÊíºÂòÖ‰∫ãÔºÅ" }, { word: "È°ØËÄåÊòìË¶ã", hint: "‰∏ÄÁùáÂ∞±ÊòéÁôΩÔºåÂ•ΩÊ∏ÖÊ•ö„ÄÇ" }
        ];

        const animalIcons = ["üê∑", "üêë", "üêÆ", "üêî", "üê±", "üê∂", "ü¶ä", "üê∞", "üêº", "üê®", "üê∏", "üêµ"];
        let currentIdiom = "", userAns = [], savedAnimals = [], idiomsSolvedInSession = 0, currentAnimal = "";

        function initHero() {
            const name = localStorage.getItem('jovan_hero_name') || "Mystery Explorer";
            const globalXp = localStorage.getItem('jovan_total_xp') || 0;
            document.getElementById('hero-name').innerText = name;
            document.getElementById('global-total-xp').innerText = globalXp;
        }

        async function addGlobalXP(amount) {
            let currentXP = parseInt(localStorage.getItem('jovan_total_xp')) || 0;
            let heroName = localStorage.getItem('jovan_hero_name') || "Mystery Explorer";
            currentXP += amount;
            localStorage.setItem('jovan_total_xp', currentXP);
            document.getElementById('global-total-xp').innerText = currentXP;

            const msg = document.createElement('div');
            msg.innerText = `+${amount} XP!`;
            msg.style = "position:fixed; top:40%; left:50%; transform:translateX(-50%); font-size:4em; color:#55FF55; text-shadow:3px 3px #000; z-index:9999; pointer-events:none; animation: fadeUp 1.5s forwards;";
            document.body.appendChild(msg);
            setTimeout(() => msg.remove(), 1500);

            try {
                await setDoc(doc(db, "leaderboard", heroName), {
                    name: heroName,
                    xp: currentXP,
                    lastUpdate: new Date()
                }, { merge: true });
            } catch (e) { console.error("Cloud Sync Failed:", e); }
        }

        function initRescueSession() {
            initHero();
            idiomsSolvedInSession = 0;
            currentAnimal = animalIcons[Math.floor(Math.random() * animalIcons.length)];
            document.getElementById('animal').innerText = currentAnimal;
            document.getElementById('rescue-scene').classList.remove('unlocked');
            document.getElementById('finishRescueBtn').style.display = 'none';
            const bars = document.querySelectorAll('.bar');
            bars.forEach(b => b.classList.remove('removed'));
            startNewIdiomInRescue();
        }

        function startNewIdiomInRescue() {
            const data = idiomDB[Math.floor(Math.random() * idiomDB.length)];
            currentIdiom = data.word;
            userAns = [];
            document.getElementById('message').innerText = `Á¨¨ ${idiomsSolvedInSession + 1}/4 ÈóúÔºö${data.hint}`;
            document.getElementById('nextQuestBtn').style.display = 'none';
            const shuffled = currentIdiom.split('').sort(() => Math.random() - 0.5);
            const cardsDiv = document.getElementById('cards');
            cardsDiv.innerHTML = shuffled.map((char, i) => `<div class="word-card" id="card-${i}" onclick="placeWord('${char}', ${i})">${char}</div>`).join('');
            updateUI();
        }

        function placeWord(char, cardIdx) {
            let nextSlot = userAns.length;
            if (nextSlot < 4) {
                if (char === currentIdiom[nextSlot]) {
                    userAns.push(char);
                    document.getElementById(`card-${cardIdx}`).classList.add('used');
                    updateUI();
                    if (userAns.length === 4) idiomCorrect();
                } else {
                    document.getElementById('message').innerText = "ÊêµÈåØÂ≠óÂñáÔºåËÅΩÂ§öÊ¨°ËÆÄÈü≥ÂÜçË©¶‰∏ãÔºü";
                    const slot = document.getElementById(`slot-${nextSlot}`);
                    slot.style.background = "rgba(231, 76, 60, 0.5)";
                    setTimeout(() => slot.style.background = "rgba(0,0,0,0.6)", 300);
                }
            }
        }

        function updateUI() {
            for (let i = 0; i < 4; i++) {
                const slot = document.getElementById(`slot-${i}`);
                slot.innerText = userAns[i] || "";
                slot.classList.toggle('correct-slot', !!userAns[i]);
            }
        }

        function resetSlots() {
            userAns = [];
            document.querySelectorAll('.word-card').forEach(c => c.classList.remove('used'));
            updateUI();
        }

        function idiomCorrect() {
            const bars = document.querySelectorAll('.bar');
            bars[idiomsSolvedInSession].classList.add('removed');
            idiomsSolvedInSession++;
            addGlobalXP(2); // Á≠îÂï±‰∏ÄÈ°å +2XP
            speakIdiom();
            if (idiomsSolvedInSession === 4) rescueSuccess();
            else {
                document.getElementById('message').innerText = `Â•ΩÂò¢ÔºÅÈñãÂíóÁ¨¨ ${idiomsSolvedInSession} Ê¢ùÊü±ÂñáÔºÅ`;
                document.getElementById('nextQuestBtn').style.display = 'inline-block';
            }
        }

        function rescueSuccess() {
            document.getElementById('rescue-scene').classList.add('unlocked');
            document.getElementById('message').innerText = "üíé ÊàêÂäüÊïëÂá∫ÂãïÁâ©ÔºÅÂ§™ÁäÄÂà©ÂñáÔºÅ üíé";
            document.getElementById('finishRescueBtn').style.display = 'inline-block';
            savedAnimals.push(currentAnimal);
            updateCollection();
            document.getElementById('xp-bar').style.width = "100%";
            setTimeout(() => { document.getElementById('xp-bar').style.width = "0%"; }, 2000);
        }

        function updateCollection() {
            const shelf = document.getElementById('collection-shelf');
            shelf.innerHTML = savedAnimals.map(a => `<div class="collected-animal">${a}</div>`).join('');
            document.getElementById('saveCount').innerText = savedAnimals.length;
        }

        function speakIdiom() {
            const m = new SpeechSynthesisUtterance(currentIdiom);
            m.lang = 'zh-HK'; m.rate = 0.7; window.speechSynthesis.speak(m);
        }

        window.placeWord = placeWord;
        window.resetSlots = resetSlots;
        window.startNewIdiomInRescue = startNewIdiomInRescue;
        window.initRescueSession = initRescueSession;
        window.speakIdiom = speakIdiom;
        window.onload = initRescueSession;
    </script>
</body>
</html>