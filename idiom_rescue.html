<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jovan's Idiom Rescue: 4-Quest</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'VT323', "Kaiti TC", "æ¥·é«”", sans-serif; 
            background-color: #4aa02c; 
            background-image: repeating-conic-gradient(#4aa02c 0% 25%, #449028 0% 50%);
            background-size: 60px 60px; color: #fff; text-align: center; margin: 0; padding: 10px; overflow-x: hidden;
        }

        /* æ‹¯æ•‘å ´æ™¯ */
        #rescue-scene { position: relative; width: 220px; height: 220px; margin: 15px auto; background: #999; border: 8px solid #3d2b1f; border-radius: 10px; box-shadow: 0 10px 0 rgba(0,0,0,0.5); }
        #animal { font-size: 110px; line-height: 200px; transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        
        /* å››æ¢éµæŸ± */
        .bars-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; justify-content: space-around; padding: 0 10px; box-sizing: border-box; z-index: 10; }
        .bar { width: 12px; height: 100%; background: #555; border-left: 4px solid #777; border-right: 4px solid #333; transition: transform 0.8s, opacity 0.5s; }
        .bar.removed { transform: translateY(-110%); opacity: 0; }

        .unlocked #animal { transform: scale(1.3) rotate(10deg); text-shadow: 0 0 20px #fff; }

        /* æˆèªç©ºæ ¼ */
        .slot-container { display: flex; justify-content: center; gap: 8px; margin: 15px 0; }
        .slot { width: 65px; height: 65px; background: rgba(0,0,0,0.6); border: 4px solid #fff; border-radius: 10px; font-size: 40px; line-height: 65px; color: #FFFF55; transition: 0.3s; }
        .slot.correct-slot { border-color: #55FF55; background: rgba(85, 255, 85, 0.2); }

        /* å­—å¡ */
        .card-container { display: flex; justify-content: center; gap: 12px; margin-top: 20px; flex-wrap: wrap; }
        .word-card { 
            width: 75px; height: 75px; background: #8b5e3c; border: 4px solid #3d2b1f; 
            border-bottom-width: 8px; border-radius: 10px; font-size: 40px; line-height: 75px; 
            cursor: pointer; transition: 0.1s; color: #fff; box-shadow: 0 4px 0 #000;
        }
        .word-card:active { transform: translateY(4px); border-bottom-width: 4px; }
        .word-card.used { opacity: 0; pointer-events: none; }

        #message { font-size: 1.6em; color: #FFFF55; text-shadow: 2px 2px #000; min-height: 1.2em; margin: 10px 0; }
        .btn { padding: 10px 25px; font-family: 'VT323'; font-size: 1.4em; cursor: pointer; border: 4px solid #333; color: #fff; background: #3498db; margin: 5px; border-bottom-width: 6px; }
        .btn:active { transform: translateY(4px); border-bottom-width: 2px; }
        .btn-speak { background: #f1c40f; color: #000; }

        /* åœ–é‘‘æ”¶è—æ¬„ */
        #collection-shelf { background: rgba(0,0,0,0.4); border: 4px solid #3d2b1f; border-radius: 15px; margin: 20px auto; max-width: 900px; padding: 15px; min-height: 60px; display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
        .collected-animal { font-size: 35px; background: rgba(255,255,255,0.1); border-radius: 8px; padding: 5px; animation: popIn 0.5s forwards; }
        @keyframes popIn { 0% { transform: scale(0); } 100% { transform: scale(1); } }

        /* XP Bar */
        #xp-container { position: fixed; bottom: 0; left: 0; width: 100%; height: 15px; background: #222; z-index: 100; }
        #xp-bar { height: 100%; width: 0%; background: #55FF55; transition: width 0.5s; }
    </style>
</head>
<body>

    <h1 style="text-shadow: 3px 3px #000; color: #55FF55; margin: 10px 0;">ğŸ¾ IDIOM RESCUE PRO v4 ğŸ¾</h1>

    <div id="rescue-scene">
        <div class="bars-container" id="bars">
            <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
        </div>
        <div id="animal">ğŸ·</div>
    </div>

    <div id="message">ç­”å•± 4 å€‹æˆèªå°±æ•‘åˆ°å‹•ç‰©ï¼</div>

    <div style="margin-bottom: 10px;">
        <button class="btn btn-speak" onclick="speakIdiom()">ğŸ”Š è½è®€éŸ³ (Listen)</button>
    </div>

    <div class="slot-container" id="slot-actual">
        <div class="slot" id="slot-0"></div><div class="slot" id="slot-1"></div>
        <div class="slot" id="slot-2"></div><div class="slot" id="slot-3"></div>
    </div>

    <div class="card-container" id="cards"></div>

    <div style="margin-top: 15px;">
        <button class="btn" style="background:#e74c3c" onclick="resetSlots()">ğŸ—‘ï¸ é‡è©¦é¡Œ (Reset)</button>
        <button class="btn" id="nextQuestBtn" style="display:none; background:#f1c40f; color:#000;" onclick="startNewIdiomInRescue()">â­ï¸ ä¸‹ä¸€é—œ (Next Quest)</button>
        <button class="btn" id="finishRescueBtn" style="display:none; background:#55FF55; color:#000;" onclick="initRescueSession()">ğŸ æ•‘ä¸‹ä¸€éš» (New Animal)</button>
    </div>

    <h3 style="margin-bottom: 5px; text-shadow: 2px 2px #000;">My Collection (å·²æ•‘å‹•ç‰©: <span id="saveCount">0</span>)</h3>
    <div id="collection-shelf"></div>

    <div id="xp-container"><div id="xp-bar"></div></div>

    <script>
        // ... (100 å€‹æˆèªæ•¸æ“š)
		const idiomDB = [
		    // æ•¸å­—é¡ (Numbers)
		    { word: "ä¸€äº”ä¸€å", hint: "è±¬ä»”æƒ³è½ä½ è¬›å¾—æ¸…æ¸…æ¥šæ¥šï¼" },
		    { word: "ä¸€å¿ƒä¸€æ„", hint: "ç¾Šä»”æƒ³ä½ å°ˆå¿ƒæ•‘ä½¢ï¼" },
		    { word: "ä¸‰å¿ƒäºŒæ„", hint: "å””å¥½è«—ä½ç© Minecraft å‘€ï¼Œå°ˆå¿ƒå•²ï¼" },
		    { word: "å››é€šå…«é”", hint: "å‘¢æ¢è·¯å¥½ä¼¼ç¤¦å‘å’å‘¨åœéƒ½å»åˆ°ã€‚" },
		    { word: "äº”å…‰åè‰²", hint: "ç‰›ç‰›é¾æ„å½©è‰²å˜…ä¸–ç•Œï¼" },
		    { word: "å…­ç¥ç„¡ä¸»", hint: "å°é›åš‡åˆ°å””çŸ¥å»å’—é‚Šï¼" },
		    { word: "ä¸ƒä¸Šå…«ä¸‹", hint: "æ•‘å””åˆ°ç‹ç‹¸ä»”ï¼Œå¿ƒè·³å¾—å¥½å¿«ï¼" },
		    { word: "å…«ä»™éæµ·", hint: "å¤§å®¶ä¸€é½Šç”¨è¶…èƒ½åŠ›æ•‘å‹•ç‰©ï¼" },
		    { word: "ä¹ç‰›ä¸€æ¯›", hint: "æ•‘ä¸€éš»ç‰›ç‰›åªä¿‚å¥½å°äº‹ï¼" },
		    { word: "åå…¨åç¾", hint: "æ•‘æ™’æ‰€æœ‰å‹•ç‰©å°±æœ€å®Œç¾å–‡ï¼" },
		    { word: "ç™¾ç™¼ç™¾ä¸­", hint: "å¥½ä¼¼ç”¨å¼“ç®­å°„ä¸­é¶å¿ƒå’æº–ï¼" },
		    { word: "åƒè®Šè¬åŒ–", hint: "å‘¢å€‹åœ°åœ–å¥½ç¥ç¥•ï¼Œæˆæ—¥è®Šï¼" },

		    // å‹•ç‰©é¡ (Animals)
		    { word: "é¾é£›é³³èˆ", hint: "å•²å­—å¯«å¾—å¥½éšï¼Œå¥½ä¼¼é¾å–ºåº¦é£›ï¼" },
		    { word: "è™é ­è›‡å°¾", hint: "æ•‘å‹•ç‰©è¦æ•‘åˆ°åº•ï¼Œå””å¥½åŠé€”è€Œå»¢ï¼" },
		    { word: "ç‹å‡è™å¨", hint: "å°ç‹ç‹¸æƒ³æ‰®è€è™å»åš‡äººï¼" },
		    { word: "ç‹¼åè™åš¥", hint: "é¤“å’—å¥½è€å˜…ç‹¼ä»”å–ºåº¦å¤§å£é£Ÿå˜¢ï¼" },
		    { word: "é›é£›ç‹—è·³", hint: "è¾²å ´ç™¼ç”Ÿå’—å’©äº‹ï¼Ÿå’å˜ˆå˜…ï¼" },
		    { word: "é¦¬åˆ°åŠŸæˆ", hint: "é¦¬ä»”ç¥ä½ ä¸€è©¦å°±æˆåŠŸï¼" },
		    { word: "äº¡ç¾Šè£œç‰¢", hint: "ç¾Šä»”èµ°å’—ï¼Ÿå¿«å•²æ•´è¿”å¥½å€‹æ¬„å•¦ï¼" },
		    { word: "äº•åº•ä¹‹è›™", hint: "é’è›™ä»”æƒ³è·³å‡ºå€‹äº•ç‡ä¸–ç•Œï¼" },
		    { word: "å®ˆæ ªå¾…å…”", hint: "å…”ä»”å””æœƒè‡ªå·±æ’åŸ‹åšŸã—ï¼Œå¿«å•²æ•‘ä½¢ï¼" },
		    { word: "ç•«é¾é»ç›", hint: "æœ€å¾Œä¸€ç­†å¯«å•±ï¼Œé¾å°±é£›å‡ºåšŸï¼" },

		    // å¤©æ°£èˆ‡è‡ªç„¶é¡ (Weather & Nature)
		    { word: "é¢¨å’Œæ—¥éº—", hint: "ä»Šæ—¥å¤©æ°£å¥½å¥½ï¼Œæœ€å•±å»æ¢éšªï¼" },
		    { word: "é™½å…‰ç‡¦çˆ›", hint: "å¤ªé™½ä¼¯ä¼¯å‡ºå’—åšŸï¼Œå””é©š Creeper å–‡ï¼" },
		    { word: "æ˜¥æš–èŠ±é–‹", hint: "æ˜¥å¤©åˆ°å’—ï¼ŒèŠ±åœ’å•²èŠ±é–‹æ™’å–‡ï¼" },
		    { word: "çƒˆæ—¥ç•¶ç©º", hint: "å¥½ç†±å‘€ï¼Œå¿«å•²æ•‘ç‰›ç‰›å»é™°æ¶¼è™•ï¼" },
		    { word: "ç§‹é«˜æ°£çˆ½", hint: "ç§‹å¤©å˜…é¢¨å¹å¾—å¥½èˆ’æœã€‚" },
		    { word: "å†°å¤©é›ªåœ°", hint: "é›ªåœ°å¥½å‡ï¼Œå¿«å•²å¹«ç‹¼ä»”ä¿æš–ï¼" },
		    { word: "å±±é’æ°´ç§€", hint: "å‘¢å€‹ä¸–ç•Œå˜…å±±æ°´çœŸä¿‚éšï¼" },
		    { word: "é¢¨å¹³æµªéœ", hint: "å¤§æµ·å¥½å¹³éœï¼Œåèˆ¹å»æ•‘äººå•¦ï¼" },

		    // äººç‰©èˆ‡å¤–è²Œé¡ (Appearance)
		    { word: "çœ‰æ¸…ç›®ç§€", hint: "å‘¢å€‹äººæœ›è½å¥½ç²¾ç¥å–ï¼" },
		    { word: "è¡£å† æ¥šæ¥š", hint: "è‘—å¾—å¥½æ•´é½Šï¼Œå¥½ä¼¼è¦å»åƒåŠ èšæœƒã€‚" },
		    { word: "å‚é ­å–ªæ°£", hint: "å””å¥½å””é–‹å¿ƒï¼Œå†è©¦ä¸€æ¬¡å°±æ•‘åˆ°ï¼" },
		    { word: "ç›®çªå£å‘†", hint: "è¦‹åˆ° Enderman åš‡åˆ°å‘†å’—ï¼" },
		    { word: "æ§è…¹å¤§ç¬‘", hint: "è±¬ä»”è·³èˆä»¤åˆ°å¤§å®¶å¥½é–‹å¿ƒï¼" },
		    { word: "å£è‹¥æ‡¸æ²³", hint: "è¬›å˜¢å¥½æµåˆ©ï¼Œåœå””åˆ°å£ï¼" },

		    // å­¸ç¿’èˆ‡å“è³ªé¡ (Learning & Character)
		    { word: "å»¢å¯¢å¿˜é£Ÿ", hint: "å°ˆå¿ƒåˆ°å””è¨˜å¾—é£Ÿé£¯åŒç“è¦ºï¼" },
		    { word: "èšç²¾æœƒç¥", hint: "å°çœ¼æœ›å¯¦å€‹è¢å¹•ï¼Œå°ˆå¿ƒæ•‘å‹•ç‰©ï¼" },
		    { word: "è‡ªè¨€è‡ªèª", hint: "ç‹—ç‹—å–ºåº¦ç´°è²åŒè‡ªå·±è¬›å˜¢ã€‚" },
		    { word: "å¤§å…¬ç„¡ç§", hint: "è²“è²“æƒ³å¤§å®¶å…¬å¹³åˆ†é…é­šé­šï¼" },
		    { word: "æ¨å·±ç‚ºäºº", hint: "å‹‡æ•¢å˜… Steve èµ°å»æ•‘å¤§å®¶ï¼" },
		    { word: "çŸ¥éŒ¯èƒ½æ”¹", hint: "å¯«éŒ¯å’—å””ç·Šè¦ï¼Œæ”¹è¿”å°±ä¿‚å¥½ç´°è·¯ï¼" },
		    { word: "åŠé€”è€Œå»¢", hint: "å””å¥½ç©åˆ°ä¸€åŠå°±èµ°å’—å»å‘€ï¼" },
		    { word: "å…¨åŠ›ä»¥èµ´", hint: "ç”¨æ™’æ‰€æœ‰åŠ›æ°£å»å®Œæˆæ¯æ—¥ä»»å‹™ï¼" },

		    // æ›´å¤šå¸¸ç”¨æˆèª... (ç¯‡å¹…é—œä¿‚ï¼Œæˆ‘ç²¾é¸å’—æœ€æ ¸å¿ƒå˜… 100 å€‹å…¥å»)
		    { word: "ååˆ—å‰èŒ…", hint: "è€ƒè©¦è€ƒå¾—å¥½ï¼Œæ’å–ºå¥½å‰é¢ï¼" },
		    { word: "åå‰¯å…¶å¯¦", hint: "çœŸä¿‚å¥½ä¼¼å‚³èä¸­å’å‹ï¼" },
		    { word: "æ‹”è‹—åŠ©é•·", hint: "å””å¥½æ€¥ï¼Œç¦¾è‹—è¦æ…¢æ…¢å¤§ã—ã€‚" },
		    { word: "æ°´è½çŸ³å‡º", hint: "çœŸç›¸çµ‚æ–¼å‡ºç¾å–‡ï¼" },
		    { word: "å‡ºå£æˆç« ", hint: "ä¸€é–‹å£å°±è¬›åˆ°å¥½éšå˜…å¥å­ã€‚" },
		    { word: "åŠ©äººç‚ºæ¨‚", hint: "å¹«åˆ°äººï¼Œè‡ªå·±éƒ½é–‹å¿ƒå•²ï¼" },
		    { word: "è€³ç›®ä¸€æ–°", hint: "æ›å’—æ–° Skinï¼Œæˆå€‹äººå””åŒæ™’ï¼" },
		    { word: "è¦‹ç¾©å‹‡ç‚º", hint: "è¦‹åˆ°æœ‰å‹•ç‰©è¢«å›°ï¼Œå³åˆ»è¡å»æ•‘ï¼" },
		    { word: "å…‰é™°ä¼¼ç®­", hint: "æ™‚é–“éå¾—å¥½å¿«ï¼Œè¦çæƒœå‘€ï¼" },
		    { word: "åå±±å¤§å·", hint: "å»æ—…è¡Œç‡ä¸‹ä¸–ç•Œå„åœ°å˜…åå±±ã€‚" },
		    { word: "å› ææ–½æ•™", hint: "æ¯å€‹äººå­¸å˜¢å˜…æ–¹æ³•éƒ½å””åŒã€‚" },
		    { word: "å¤šæ‰å¤šè—", hint: "Jovan åˆè­˜å½ˆç´åˆè­˜å¯« Codeï¼" },
		    { word: "å¦‚é­šå¾—æ°´", hint: "å»åˆ°é¾æ„å˜…ç’°å¢ƒï¼Œå¥½è‡ªåœ¨ï¼" },
		    { word: "å®‰åˆ†å®ˆå·±", hint: "ä¹–ä¹–åœ°å®ˆè¦çŸ©ã€‚" },
		    { word: "è‡ªå¼·ä¸æ¯", hint: "æ¯æ—¥éƒ½è¦åŠªåŠ›é€²æ­¥ï¼" },
		    { word: "æ±—æµæµ¹èƒŒ", hint: "åšå®Œé‹å‹•ï¼Œæˆèº«éƒ½ä¿‚æ±—ã€‚" },
		    { word: "å¦™æ‰‹å›æ˜¥", hint: "å¥½ä¼¼é†«ç”Ÿå’é†«è¿”å¥½å—å‚·å˜…è±¬ä»”ã€‚" },
		    { word: "å¿—åŒé“åˆ", hint: "æµåˆ°ä¸€ç­å¥½æœ‹å‹ä¸€é½Šç© Minecraftï¼" },
		    { word: "æ”¹é‚ªæ­¸æ­£", hint: "æ€ªç¸éƒ½æƒ³è®Šè¿”å¥½äººã€‚" },
		    { word: "å–é•·è£œçŸ­", hint: "å­¸ä¸‹äººå“‹å˜…å„ªé»ã€‚" },
		    { word: "ä¾ä¾ä¸æ¨", hint: "è¦æ”¶æ©Ÿå–‡ï¼ŒçœŸä¿‚å””æ¨å¾—ã€‚" },
		    { word: "ç‰©ç¾åƒ¹å»‰", hint: "å–ºè‹±åœ‹è¶…å¸‚è²·åˆ°åˆå¹³åˆå¥½å˜…å˜¢ã€‚" },
		    { word: "è‹¦ç›¡ç”˜ä¾†", hint: "è¾›è‹¦å®Œï¼Œçµ‚æ–¼æœ‰æ”¶ç©«ï¼" },
		    { word: "ç¾ä¸å‹æ”¶", hint: "é¢¨æ™¯éšåˆ°ç‡å””æ™’ã€‚" },
		    { word: "é¢ç´…è€³èµ¤", hint: "å””å¥½çˆ­åµï¼Œè¬›åˆ°é¢éƒ½ç´…æ™’ã€‚" },
		    { word: "æ´—å¿ƒé©é¢", hint: "æ±ºå®šé‡æ–°åšä¸€å€‹å¥½äººã€‚" },
		    { word: "æ´¥æ´¥æœ‰å‘³", hint: "é£Ÿå¾—å¥½é–‹å¿ƒï¼Œå¥½å¥½å‘³ï¼" },
		    { word: "æµé€£å¿˜è¿”", hint: "å‘¢å€‹å…¬åœ’å¤ªå¥½ç©ï¼Œå””æƒ³è¿”å±‹ä¼ã€‚" },
		    { word: "èƒ¸æœ‰æˆç«¹", hint: "å¥½æœ‰ä¿¡å¿ƒå¯ä»¥æ•‘åˆ°å‹•ç‰©ï¼" },
		    { word: "è²¡æºå»£é€²", hint: "ç¥å¤§å®¶è³ºå¤šå•²éŒ¢è²·é‘½çŸ³ï¼" },
		    { word: "æƒ…æ·±ç¾©é‡", hint: "å¤§å®¶å˜…å‹èª¼å¥½æ·±åšã€‚" },
		    { word: "å¾—æ„å¿˜å½¢", hint: "å””å¥½é–‹å¿ƒéé ­ï¼Œå°å¿ƒè·Œè¦ªï¼" },
		    { word: "æ·±æ€ç†Ÿæ…®", hint: "è«—æ¸…æ¥šå…ˆè‡³è¡Œå‹•ã€‚" },
		    { word: "è²ªå°ä¾¿å®œ", hint: "å””å¥½å› ç‚ºå°‘å°‘å˜¢è€Œè²ªå¿ƒã€‚" },
		    { word: "æ‚¶æ‚¶ä¸æ¨‚", hint: "ä»Šæ—¥é»è§£å””é–‹å¿ƒå‘€ï¼Ÿè¬›ç•€æˆ‘è½ã€‚" },
		    { word: "æšçœ‰åæ°£", hint: "çµ‚æ–¼è´å’—ï¼ŒçœŸä¿‚å¥½é–‹å¿ƒï¼" },
		    { word: "æœæ°£è“¬å‹ƒ", hint: "æ¯æ—¥èµ·èº«éƒ½å……æ»¿æ´»åŠ›ï¼" },
		    { word: "å¾ªåºæ¼¸é€²", hint: "ä¸€æ­¥ä¸€æ­¥æ…¢æ…¢å­¸ï¼Œå””ä½¿æ€¥ã€‚" },
		    { word: "å¾®ä¸è¶³é“", hint: "å‘¢å•²åªä¿‚å¥½å°å˜…äº‹ã€‚" },
		    { word: "æ„æ°£é¢¨ç™¼", hint: "è´å’—æ¯”è³½ï¼Œå¥½å¨é¢¨ï¼" },
		    { word: "æ„›ä¸é‡‹æ‰‹", hint: "å‘¢å€‹ Minecraft ç©å…·çœŸä¿‚å¥½é¾æ„ã€‚" },
		    { word: "è½è’è€Œé€ƒ", hint: "è¦‹åˆ° Creeper å°±è¦å¿«å•²èµ°ï¼" },
		    { word: "å°ç‰›å½ˆç´", hint: "åŒå””æ˜å˜…äººè¬›é“ç†ï¼Œå†‡ç”¨ã—ã€‚" },
		    { word: "å¯¦äº‹æ±‚æ˜¯", hint: "è¦åšè¿”å•²çœŸæ­£æœ‰æ„ç¾©å˜…äº‹ã€‚" },
		    { word: "ç²¾ç›Šæ±‚ç²¾", hint: "å·²ç¶“åšå¾—å¥½å¥½ï¼Œæƒ³å†åšå¥½å•²ï¼" },
		    { word: "èšæ²™æˆå¡”", hint: "æ…¢æ…¢å„²ï¼Œå°±å¯ä»¥è®Šå‡ºå¤§åŸå ¡ã€‚" },
		    { word: "å­¸ç„¡æ­¢å¢ƒ", hint: "å­¸å˜¢ä¿‚ä¸€ä¸–å˜…äº‹ã€‚" },
		    { word: "æ©Ÿæ™ºå‹‡æ•¢", hint: "åˆè°æ˜åˆå‹‡æ•¢å»æŒ‘æˆ°é›£é—œã€‚" },
		    { word: "èˆ‰ä¸€åä¸‰", hint: "å­¸ä¸€ä»¶äº‹ï¼Œå°±å¯ä»¥è«—åˆ°ä¸‰ä»¶äº‹ï¼" },
		    { word: "è¬™è™›å¥½å­¸", hint: "å””è‡ªå¤§ï¼Œåˆé¾æ„å­¸æ–°å˜¢ã€‚" },
		    { word: "è±ç„¶é–‹æœ—", hint: "çªç„¶ä¹‹é–“æ˜ç™½æ™’æ‰€æœ‰å˜¢ï¼" },
		    { word: "è®€è¬å·æ›¸", hint: "è¦è®€å¤šå•²æ›¸ï¼Œå¥½ä¼¼è¡Œå’—è¬é‡Œè·¯ã€‚" },
		    { word: "éµçŸ³å¿ƒè…¸", hint: "å””å¥½å’ç¡¬å¿ƒè…¸ï¼Œå¿«å•²æ•‘å‹•ç‰©ï¼" },
		    { word: "æ­¡å¤©å–œåœ°", hint: "å¤§å®¶ä¸€é½Šå»æ…¶ç¥å›‰ï¼" },
		    { word: "é©šå¤©å‹•åœ°", hint: "ç™¼ç”Ÿå’—ä¸€ä»¶å¥½éœ‡æ’¼å˜…äº‹ï¼" },
		    { word: "é¡¯è€Œæ˜“è¦‹", hint: "ä¸€ç‡å°±æ˜ç™½ï¼Œå¥½æ¸…æ¥šã€‚" }
		];

        const animalIcons = ["ğŸ·", "ğŸ‘", "ğŸ®", "ğŸ”", "ğŸ±", "ğŸ¶", "ğŸ¦Š", "ğŸ°", "ğŸ¼", "ğŸ¨", "ğŸ¸", "ğŸµ"];
        let currentIdiom = "", userAns = [], savedAnimals = [];
        let currentAnimal = "", idiomsSolvedInSession = 0;

        // åˆå§‹åŒ–æ•´å€‹æ‹¯æ•‘éç¨‹ (æ•‘ä¸€éš»æ–°å‹•ç‰©)
        function initRescueSession() {
            idiomsSolvedInSession = 0;
            currentAnimal = animalIcons[Math.floor(Math.random() * animalIcons.length)];
            document.getElementById('animal').innerText = currentAnimal;
            document.getElementById('rescue-scene').classList.remove('unlocked');
            document.getElementById('finishRescueBtn').style.display = 'none';
            
            const bars = document.querySelectorAll('.bar');
            bars.forEach(b => b.classList.remove('removed'));
            
            startNewIdiomInRescue();
        }

        // å–ºåŒä¸€å€‹æ‹¯æ•‘éç¨‹ä¸­æ›ä¸‹ä¸€é¡Œ
        function startNewIdiomInRescue() {
            const data = idiomDB[Math.floor(Math.random() * idiomDB.length)];
            currentIdiom = data.word;
            userAns = [];
            document.getElementById('message').innerText = `ç¬¬ ${idiomsSolvedInSession + 1}/4 é—œï¼š${data.hint}`;
            document.getElementById('nextQuestBtn').style.display = 'none';
            
            const shuffled = currentIdiom.split('').sort(() => Math.random() - 0.5);
            const cardsDiv = document.getElementById('cards');
            cardsDiv.innerHTML = shuffled.map((char, i) => `
                <div class="word-card" id="card-${i}" onclick="placeWord('${char}', ${i})">${char}</div>
            `).join('');

            updateUI();
        }

        function placeWord(char, cardIdx) {
            let nextSlot = userAns.length;
            if (nextSlot < 4) {
                if (char === currentIdiom[nextSlot]) {
                    userAns.push(char);
                    document.getElementById(`card-${cardIdx}`).classList.add('used');
                    updateUI();
                    if (userAns.length === 4) idiomCorrect();
                } else {
                    document.getElementById('message').innerText = "æµéŒ¯å­—å–‡ï¼Œè½å¤šæ¬¡è®€éŸ³å†è©¦ä¸‹ï¼Ÿ";
                    const slot = document.getElementById(`slot-${nextSlot}`);
                    slot.style.background = "rgba(231, 76, 60, 0.5)";
                    setTimeout(() => slot.style.background = "rgba(0,0,0,0.6)", 300);
                }
            }
        }

        function updateUI() {
            for (let i = 0; i < 4; i++) {
                const slot = document.getElementById(`slot-${i}`);
                slot.innerText = userAns[i] || "";
                slot.classList.toggle('correct-slot', !!userAns[i]);
            }
        }

        function resetSlots() {
            userAns = [];
            document.querySelectorAll('.word-card').forEach(c => c.classList.remove('used'));
            updateUI();
        }

        // ç•¶ä¸€å€‹æˆèªç­”å•±å’—
        function idiomCorrect() {
            // ç§»é™¤ä¸€æ¢æŸ±
            const bars = document.querySelectorAll('.bar');
            bars[idiomsSolvedInSession].classList.add('removed');
            
            idiomsSolvedInSession++;
            speakIdiom();

            if (idiomsSolvedInSession === 4) {
                rescueSuccess();
            } else {
                document.getElementById('message').innerText = `å¥½å˜¢ï¼é–‹å’—ç¬¬ ${idiomsSolvedInSession} æ¢æŸ±å–‡ï¼`;
                document.getElementById('nextQuestBtn').style.display = 'inline-block';
            }
        }

        // æ•‘æˆåŠŸ (4 é—œéæ™’)
        function rescueSuccess() {
            document.getElementById('rescue-scene').classList.add('unlocked');
            document.getElementById('message').innerText = "ğŸ’ æˆåŠŸæ•‘å‡ºå‹•ç‰©ï¼å¤ªçŠ€åˆ©å–‡ï¼ ğŸ’";
            document.getElementById('finishRescueBtn').style.display = 'inline-block';
            
            savedAnimals.push(currentAnimal);
            updateCollection();
            
            // æ»¿ XP
            document.getElementById('xp-bar').style.width = "100%";
            setTimeout(() => { document.getElementById('xp-bar').style.width = "0%"; }, 2000);
        }

        function updateCollection() {
            const shelf = document.getElementById('collection-shelf');
            shelf.innerHTML = savedAnimals.map(a => `<div class="collected-animal">${a}</div>`).join('');
            document.getElementById('saveCount').innerText = savedAnimals.length;
        }

        function speakIdiom() {
            const m = new SpeechSynthesisUtterance(currentIdiom);
            m.lang = 'zh-HK'; m.rate = 0.7; window.speechSynthesis.speak(m);
        }

        window.onload = initRescueSession;
    </script>
</body>
</html>